{% extends "network/layout.html" %}

{% block body %}

{{view_profile.username}}
{{view_profile.email}}

<p>Following: {{n_following}}</p>
<p>Followers: {{n_follows}}</p>

{% if not view_profile == request.user %}
    <div class="btn btn-primary" id="btn-follow" onclick="actFollow('{{ view_profile.id }}');">Please wait
    </div>
    <script>
        document.querySelector('#btn-follow').innerHTML = "Loading...";
        (async function(){
        
        const isF = await isFollow('{{ view_profile.id }}');
        console.log(isF);    

        //isFollow('{{ view_profile.id }}')
        //.then( (value)=> console.log('Onclick view() is '+ value))
        if(isF){
            document.querySelector('#btn-follow').innerHTML = "Unfollow";
            console.log('Unfollow btn loaded'); 
        }
        else{
            document.querySelector('#btn-follow').innerHTML = "Follow";
            console.log('Follow btn loaded'); 
        }
        
        
        })()

        function actFollow(id){
    console.log('Boton de accion *Follow/Un* fue apretado');
    fetch(`/actFollow/${id}`, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({id : id}),
        })      
      .then(response => response.json())
      .then(response => {
        console.log('Resultado:  '+response.message);
        location.reload();
    })
    .catch(error => console.error('Error:', error));
    
};
        
    </script>
{% endif %}
    
{% for post in posts %}

<div class="each-post">
    {% if view_profile == request.user %}
    <button class="btn btn-secondary" onclick="editPost('{{post.id}}')"><i class="bi bi-pencil-fill"></i> Edit</button>
    {% endif %}
    <time>{{post.timestamp}}</time> 
    <!--<a href="{% url 'profile' post.writed_by%}">{{post.writed_by}}</a>-->
    <p id="post{{post.id}}">{{post.post_message}}</p>
</div>
{% endfor %}

{% endblock %}